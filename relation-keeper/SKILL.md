---
name: relation-keeper
description: |
  ç»´æŠ¤ã€è®°å¿†ã€æé†’ä½ çš„ç¤¾äº¤å…³ç³»ã€‚ç”¨äºï¼š(1) è®°å½•å’Œç´¯ç§¯äººç‰©è‚–åƒï¼ˆæ€§åˆ«ã€å‡ºç”Ÿå¹´/æ—¥ã€å®¶åº­åœ°å€ã€æ‰‹æœºã€ä¸€èµ·åšè¿‡çš„äº‹ç­‰ï¼‰ï¼Œ
  (2) è®°å½•æœªæ¥çš„çº¦ä¼šã€çºªå¿µæ—¥ã€ç”Ÿæ—¥å¹¶è®¾ç½®åˆ†çº§æé†’ï¼Œ(3) å½’æ¡£è¿‡å»å…±åŒç»å†ï¼ˆçº¦ä¼šã€åƒé¥­ã€æ¸¸ç©ç­‰ï¼‰ï¼Œ
  ä»¥ä¾¿åç»­æŸ¥è¯¢æŸäººæ—¶èƒ½å›æº¯ã€‚
metadata:
  openclaw:
    slug: relation-keeper
    emoji: "ğŸ‘¥"
    requires: {}
    install:
      - id: "setup-cron"
        kind: "run"
        label: "é…ç½®æé†’æ‰«æå®šæ—¶ä»»åŠ¡"
        command: "node scripts/install.js"
---

# å…³ç³»ç»´æŠ¤ Relation Keeper

ç»´æŠ¤ä½ çš„ç¤¾äº¤å…³ç³»ç½‘ç»œï¼š**è‚–åƒç»´æŠ¤**ã€**æœªæ¥æé†’**ã€**è¿‡å»å½’æ¡£**ã€‚

---

## ä¸€ã€æ•°æ®å­˜å‚¨

æ•°æ®å­˜å‚¨åœ¨ `$RELATION_KEEPER_DATA` æŒ‡å‘çš„ç›®å½•ï¼›æœªè®¾ç½®æ—¶ä½¿ç”¨å½“å‰ skill ç›®å½•ä¸‹çš„ `data/` æ–‡ä»¶å¤¹ã€‚

### 1.1 äººç‰©è‚–åƒ `portraits.json`

```json
{
  "people": {
    "å¼ ä¸‰": {
      "name": "å¼ ä¸‰",
      "aliases": ["è€å¼ "],
      "gender": "ç”·",
      "birthday": "03-15",
      "birthYear": 1990,
      "birthDate": "1990-03-15",
      "address": "åŒ—äº¬å¸‚æœé˜³åŒºxxè·¯xxå·",
      "phone": "+86 138****1234",
      "notes": "å¤§å­¦åŒå­¦ï¼Œåšé‡‘è",
      "updatedAt": "2026-02-05T10:00:00Z",
      "facts": [
        { "key": "å–œå¥½", "value": "å–œæ¬¢é’“é±¼", "source": "2026-01-20 èŠå¤©", "at": "2026-01-20" },
        { "key": "èŒä½", "value": "æŸé“¶è¡Œç»ç†", "source": "2026-01-20", "at": "2026-01-20" }
      ]
    }
  }
}
```

- æ¯æ¬¡ç”¨æˆ·æåŠæŸäººåŠä¸å…¶ç›¸å…³çš„äº‹ä»¶ã€ä¿¡æ¯æ—¶ï¼Œæ›´æ–°å¯¹åº” portraitã€‚
- **gender**ï¼šæ€§åˆ«ï¼ˆç”·/å¥³/å…¶ä»–ï¼‰ã€‚
- **birthday**ï¼š`MM-DD` æ ¼å¼ï¼Œç”¨äºå‘¨å¹´æé†’ã€‚
- **birthYear**ï¼šå‡ºç”Ÿå¹´ï¼ˆæ•°å­—ï¼‰ï¼Œå¯é€‰ã€‚
- **birthDate**ï¼šå‡ºç”Ÿæ—¥æœŸï¼Œå¯æ¨¡ç³Šï¼Œå¦‚ `"1990"`ã€`"1990-03"`ã€`"1990-03-15"`ã€‚
- **address**ï¼šå®¶åº­åœ°å€ã€‚
- `facts` ä¸ºé”®å€¼å¯¹åˆ—è¡¨ï¼Œå¯æŒ‰ `key` å»é‡æˆ–è¿½åŠ ï¼ˆåŒä¸€ key ä¿ç•™æœ€æ–°ä¸€æ¡ï¼‰ã€‚

### 1.2 è¿‡å»äº‹ä»¶ `past_events.json`

```json
{
  "events": [
    {
      "id": "evt-001",
      "personIds": ["å¼ ä¸‰", "æå››"],
      "type": "åƒé¥­",
      "date": "2026-01-18",
      "summary": "å’Œå¼ ä¸‰ã€æå››åœ¨æµ·åº•æèšé¤",
      "details": "è®¨è®ºåˆ›ä¸šæƒ³æ³•",
      "createdAt": "2026-02-05T10:00:00Z"
    }
  ]
}
```

- `type`ï¼šåƒé¥­ã€çº¦ä¼šã€æ¸¸ç©ã€èšä¼šã€ä¼šè®®ç­‰ã€‚
- æŸ¥è¯¢æŸäººæ—¶ï¼Œå¯åŸºäº `personIds` è¿‡æ»¤å¹¶è¿”å›ç›¸å…³ past_eventsã€‚

### 1.3 æœªæ¥äº‹ä»¶ `future_events.json`

```json
{
  "events": [
    {
      "id": "fevt-001",
      "personIds": ["å¼ ä¸‰"],
      "type": "ç”Ÿæ—¥",
      "date": "2026-03-15",
      "time": null,
      "summary": "å¼ ä¸‰ç”Ÿæ—¥",
      "reminderRule": "birthday",
      "createdAt": "2026-02-05T10:00:00Z"
    },
    {
      "id": "fevt-002",
      "personIds": ["æå››"],
      "type": "çº¦ä¼š",
      "date": "2026-02-10",
      "time": "18:30",
      "summary": "å’Œæå››æ™šé¤",
      "reminderRule": "appointment",
      "createdAt": "2026-02-05T10:00:00Z"
    }
  ]
}
```

- `reminderRule`ï¼š
  - `birthday`ï¼šç”Ÿæ—¥/çºªå¿µæ—¥è§„åˆ™
  - `appointment`ï¼šçº¦ä¼šè§„åˆ™

---

## äºŒã€æé†’è§„åˆ™ï¼šå•ä¸€æ‰«æä»»åŠ¡

**ä¸åˆ›å»ºä¸€æ¬¡æ€§æé†’**ï¼Œä½¿ç”¨**ä¸€ä¸ªæ¯ 15 åˆ†é’Ÿè¿è¡Œçš„ Cron** è°ƒç”¨ `scan.js` æ‰«æï¼Œå¦‚æœ‰éœ€è¦æé†’çš„å†…å®¹åˆ™è¾“å‡ºã€‚

### 2.1 æé†’è§„åˆ™

| äº‹ä»¶ç±»å‹ | æé†’æ—¶æœº |
|----------|----------|
| ç”Ÿæ—¥ / çºªå¿µæ—¥ | 7 å¤©å‰ã€3 å¤©å‰ã€å½“å¤©ï¼ˆæ¯å¹´æŒ‰ MM-DD åŒ¹é…ï¼‰ |
| çº¦ä¼š | äº‹ä»¶å‰ 2 å°æ—¶ã€äº‹ä»¶å½“åˆ» |

### 2.2 å®šæ—¶ä»»åŠ¡è‡ªåŠ¨é…ç½®

å®‰è£…æœ¬ skill æ—¶ï¼Œæ‰§è¡Œ `npm install` ä¼šè‡ªåŠ¨è¿è¡Œ `postinstall` è„šæœ¬ï¼Œè°ƒç”¨ `node scripts/install.js` é…ç½®å®šæ—¶ä»»åŠ¡ã€‚ç”¨æˆ·æ— éœ€æ‰‹åŠ¨æ‰§è¡Œ `openclaw cron add`ã€‚

è‹¥è‡ªåŠ¨é…ç½®å¤±è´¥ï¼Œå¯æ‰‹åŠ¨è¿è¡Œï¼š
```bash
cd <skill ç›®å½•> && npm run install:cron
```

### 2.3 scan.js è¡Œä¸º

- è¯»å– `portraits.json`ï¼ˆç”Ÿæ—¥ MM-DDï¼‰ä¸ `future_events.json`
- ç”Ÿæ—¥/çºªå¿µæ—¥ï¼šæŒ‰ MM-DD æ¯å¹´åŒ¹é…ï¼Œæ£€æŸ¥å½“å¤©ã€+3 å¤©ã€+7 å¤©
- çº¦ä¼šï¼šæ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦è½åœ¨ã€Œäº‹ä»¶å‰ 2hã€æˆ–ã€Œäº‹ä»¶å½“åˆ»ã€çª—å£å†…
- å·²å‘é€çš„æé†’è®°å½•åœ¨ `reminders_sent.json`ï¼Œé¿å…é‡å¤

### 2.4 æ·»åŠ æœªæ¥äº‹ä»¶æ—¶

ä»…éœ€å†™å…¥ `future_events.json`ï¼Œ**æ— éœ€åˆ›å»ºä»»ä½• Cron**ã€‚æ‰«æä»»åŠ¡ä¼šè‡ªåŠ¨å‘ç°å¹¶æé†’ã€‚

---

## ä¸‰ã€æŠ€èƒ½è¡Œä¸ºæŒ‡å—

### 3.1 ä½•æ—¶è§¦å‘æœ¬ skill

- ç”¨æˆ·æåŠæŸäººåŠä¸å…¶ç›¸å…³çš„ä¿¡æ¯ã€äº‹ä»¶ã€‚
- ç”¨æˆ·è¯´ã€Œè®°ä¸€ä¸‹ã€ã€Œæé†’æˆ‘ã€ã€ŒæŸäººç”Ÿæ—¥ã€ã€Œå’ŒæŸäººçº¦ä¼šã€ç­‰ã€‚
- ç”¨æˆ·é—®ã€Œæˆ‘å’Œå¼ ä¸‰ä¹‹å‰åšè¿‡ä»€ä¹ˆã€ã€Œå¼ ä¸‰å–œæ¬¢ä»€ä¹ˆã€ã€Œä¸‹å‘¨æœ‰ä»€ä¹ˆå®‰æ’ã€ç­‰ã€‚

### 3.2 è‚–åƒç»´æŠ¤

- è§£æç”¨æˆ·è¾“å…¥ä¸­çš„äººåã€äº‹ä»¶ã€å±æ€§ï¼ˆå¹´é¾„ã€æ‰‹æœºã€å–œå¥½ç­‰ï¼‰ã€‚
- æ›´æ–° `portraits.json`ï¼šæ–°å»ºæˆ–åˆå¹¶åˆ°å·²æœ‰ portraitï¼Œè¿½åŠ  `facts`ã€‚
- è‹¥äº‹ä»¶å±äºã€Œè¿‡å»ã€ï¼ŒåŒæ—¶å†™å…¥ `past_events.json`ã€‚

### 3.3 æœªæ¥äº‹ä»¶ä¸æé†’

- è§£ææ—¥æœŸã€æ—¶é—´ï¼ˆæ”¯æŒè‡ªç„¶è¯­è¨€ï¼Œå¦‚ã€Œä¸‹å‘¨äº”æ™šä¸Š 6 ç‚¹åŠã€ï¼‰ã€‚
- ç¡®å®š `reminderRule`ï¼šç”Ÿæ—¥/çºªå¿µæ—¥ç”¨ `birthday`ï¼Œå…·ä½“æ—¶é—´çº¦ä¼šç”¨ `appointment`ã€‚
- å†™å…¥ `future_events.json` å³å¯ï¼Œæ‰«æä»»åŠ¡æ¯ 15 åˆ†é’Ÿä¼šè‡ªåŠ¨å‘ç°å¹¶æé†’ã€‚
- å‘ç”¨æˆ·ç¡®è®¤ï¼šã€Œå·²è®°å½•ï¼Œåˆ°æ—¶ä¼šæé†’ä½ ã€‚ã€

### 3.4 è¿‡å»äº‹ä»¶å½’æ¡£

- ç”¨æˆ·æè¿°ã€Œä¸Šå‘¨å’Œè°åƒé¥­ã€ã€Œæ˜¨å¤©å’Œè°çº¦ä¼šã€æ—¶ï¼Œå†™å…¥ `past_events.json`ã€‚
- å…³è” `personIds`ï¼Œä¾¿äºæŒ‰äººæŸ¥è¯¢ã€‚

### 3.5 æŸ¥è¯¢

- ã€Œå¼ ä¸‰çš„ä¿¡æ¯ã€â†’ è¯»å– `portraits.json` ä¸­ `å¼ ä¸‰`ï¼Œå¹¶å¯é€‰æ±‡æ€» `past_events` ä¸­ä¸ä¹‹ç›¸å…³çš„äº‹ä»¶ã€‚
- ã€Œæˆ‘å’Œå¼ ä¸‰ä¸€èµ·åšè¿‡ä»€ä¹ˆã€â†’ æŸ¥è¯¢ `past_events` ä¸­ `personIds` åŒ…å«å¼ ä¸‰çš„äº‹ä»¶ã€‚
- ã€Œè¿‘æœŸæœ‰ä»€ä¹ˆç¤¾äº¤å®‰æ’ã€â†’ æŸ¥è¯¢ `future_events.json` æœªæ¥ N å¤©å†…äº‹ä»¶ã€‚

---

## å››ã€é…ç½®

åœ¨ shell æˆ– `~/.openclaw/.env` ä¸­ï¼š

```bash
# æ•°æ®ç›®å½•ï¼ˆå¯é€‰ï¼Œæœªè®¾ç½®æ—¶ä½¿ç”¨ skill/data/ï¼‰
export RELATION_KEEPER_DATA="$HOME/.openclaw/relation-keeper"

# æ—¶åŒºï¼ˆç”¨äºè®¡ç®—æé†’æ—¶é—´ï¼‰
export RELATION_KEEPER_TZ="Asia/Shanghai"

# æé†’å‘é€æ¸ é“ï¼ˆå¯é€‰ï¼‰
# é…ç½®åˆ™ç›´æ¥æ¨é€åˆ°è¯¥æ¸ é“ï¼Œå¦‚: export RELATION_KEEPER_CHANNEL="telegram:YOUR_CHAT_ID"
# æœªé…ç½®åˆ™æ¨é€åˆ°å½“å‰èŠå¤©ï¼ˆmain sessionï¼‰
export RELATION_KEEPER_CHANNEL=""
```

---

## äº”ã€è‡ªç„¶è¯­è¨€è§¦å‘ç¤ºä¾‹

| ç”¨æˆ·è¯´ | æŠ€èƒ½åŠ¨ä½œ |
|--------|----------|
| å¼ ä¸‰ç”Ÿæ—¥ 3 æœˆ 15 å·ï¼Œè®°ä¸€ä¸‹ | æ›´æ–° portrait ç”Ÿæ—¥ï¼Œåˆ›å»º future_event + birthday æé†’ |
| ä¸‹å‘¨äº”æ™š 6 ç‚¹åŠå’Œæå››åƒé¥­ | åˆ›å»º appointmentï¼Œè®¾ç½® 2h å‰ + å½“åˆ»æé†’ |
| ä¸Šå‘¨å’Œå¼ ä¸‰åœ¨æµ·åº•æåƒè¿‡é¥­ | å†™å…¥ past_eventï¼Œæ›´æ–° portrait |
| å¼ ä¸‰å–œæ¬¢é’“é±¼ | æ›´æ–° portrait.facts |
| å¼ ä¸‰çš„ç”µè¯æ˜¯ 138xxxx1234 | æ›´æ–° portrait.phone |
| å¼ ä¸‰æ˜¯ç”·çš„ / å¼ ä¸‰æ€§åˆ« | æ›´æ–° portrait.gender |
| å¼ ä¸‰ 1990 å¹´å‡ºç”Ÿ | æ›´æ–° portrait.birthYear / birthDate |
| å¼ ä¸‰ä½æœé˜³åŒºxxè·¯ | æ›´æ–° portrait.address |
| æˆ‘å’Œå¼ ä¸‰åšè¿‡ä»€ä¹ˆ | æŸ¥ past_eventsï¼Œæ±‡æ€»è¾“å‡º |
| å¼ ä¸‰æ˜¯è° / å¼ ä¸‰çš„ä¿¡æ¯ | è¾“å‡º portrait + ç›¸å…³ past_events æ‘˜è¦ |
| è¿‘æœŸæœ‰ä»€ä¹ˆçº¦ä¼š / ç”Ÿæ—¥ | æŸ¥ future_events æœªæ¥ 7â€“14 å¤© |

---

## å…­ã€è„šæœ¬ä¸å·¥å…·

ä» skill æ ¹ç›®å½•ï¼ˆ`relation-keeper/`ï¼‰è¿è¡Œï¼Œéœ€ Node.js 16+ï¼š

```bash
# äººç‰©è‚–åƒ
node scripts/portrait.js get å¼ ä¸‰
node scripts/portrait.js upsert å¼ ä¸‰ --birthday 03-15 --gender ç”· --birthYear 1990 --address "åŒ—äº¬å¸‚æœé˜³åŒºxxè·¯" --fact-key å–œå¥½ --fact-value é’“é±¼

# äº‹ä»¶
node scripts/events.js future-add --persons å¼ ä¸‰ --type ç”Ÿæ—¥ --date 2026-03-15 --summary "å¼ ä¸‰ç”Ÿæ—¥" --rule birthday
node scripts/events.js past-add --persons "å¼ ä¸‰,æå››" --type åƒé¥­ --date 2026-01-18 --summary "æµ·åº•æèšé¤"

# æ‰«ææé†’ï¼ˆé€šå¸¸ç”± Cron æ¯ 15 åˆ†é’Ÿè°ƒç”¨ï¼Œä¹Ÿå¯æ‰‹åŠ¨æ‰§è¡Œæµ‹è¯•ï¼‰
node scripts/scan.js

# é…ç½®å®šæ—¶ä»»åŠ¡ï¼ˆå®‰è£…æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œä¹Ÿå¯æ‰‹åŠ¨è¿è¡Œï¼‰
npm run install:cron
```
